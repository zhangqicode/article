### 前言

* 将色彩用数字表达，最初是产生于沟通（通信）的需要，设想这样一个场景：你对喷漆师傅说想把车喷成蓝色，师傅问你是天蓝色还是海蓝色，你说都不是，要比天蓝色深一点，这时喷漆师傅拿出一组卡片，上面印刷着不同深度的蓝色，你看了看说我要 157 号蓝色；这时你已经完成了一次以数字表达色彩的沟通；

* 这组颜色卡片定义了一组数字到颜色的映射关系，这种映射关系叫做色彩模型，而这组数字对应的颜色的集合叫做色彩空间，代表这组数字能表达的所有颜色；

### 色彩空间和色彩模型

一般来说，色彩空间和色彩模型是对应的，所以在非正式场合下，大家说色彩空间时也包含了色彩模型的意思（下文中均以“色彩空间”来做说明，不再单独指出色彩模型）

根据用途不同，人们设计了很多色彩空间，常见的有 RGB、CMY、YUV、HSX 系列、Lab 等，在我们的工作和生活中主要接触到的是 RGB、CMY、YUV 这三种，下面主要围绕这三种色彩空间做介绍。

### RGB

RGB 是我们接触最多的色彩空间，我们在前端开发工作中的色彩均以 RGB（或其变种）的形式定义的，比如我们想指定一个按钮的背景色为黑色，我们会设置其背景色属性为 #000000。

![顏色加法 svg](https://github.com/zhangqicode/article/assets/2979857/5d8be7a3-15d6-4a73-98f4-4fa2399df1fe)

> 为什么前端开发领域使用的色彩空间是 RGB 呢？
> * 首先 RGB 色彩空间是面向显示硬件设计的，电脑、手机等设备屏幕的显示原理都是以 RGB（红绿蓝）三种颜色的光控制一个像素色彩的显示，而前端开发领域的产物基本也就是在电脑、手机等设备上展示，天然适合使用 RGB 色彩空间来实现色彩的“沟通”（开发者与硬件设备的沟通）。
> * 不同的屏幕有不同的发光方法，例如 LCD 屏是以三种颜色的薄膜过滤白光来控制色彩，OLED 屏是以有机材料涂层通电后自发光实现的。

![weixin159643519519717 png,weixin159643519519717](https://github.com/zhangqicode/article/assets/2979857/4ee91598-faeb-485b-a0e6-91daee3aefd6)

### CMY（CMYK）

维护过打印机的同事可能会对 CMY（也称 CMYK）色彩空间有所了解，彩色打印机使用的墨水有四种颜色，分别是 C（青色）、M（洋红）、Y（黄色）、K（黑色），可以通过组合不同强度的 CMY 分量产生一个数量可观的色彩空间，满足印刷需要。

![顏色減法 svg](https://github.com/zhangqicode/article/assets/2979857/027d92c8-61e1-4320-b8f0-e142953d56d7)

> 为什么用 CMY 三种颜色做组合，而不是 RGB？
> * 印刷是通过在纸张或其他介质上涂抹颜料来实现的，遵循减色原理。CMYK 颜色通过吸收光来混合，更符合印刷介质的物理特性。RGB 色彩空间是基于加色原理，适合发光媒介（电子显示设备）。
> 
> 既然 CMY 组合可以产生黑色，为什么还需要一个单独的 K（黑色墨水）？
> * 首先是出于经济和实用性考虑，单独的黑色墨水比三种颜色的墨水混合成本更低，打印速度和干燥速度更快；另外在实际生产环境中，CMY 的墨水颜色或多或少都会存在偏色，组合产生的黑色大多只是类黑色，在深度和阴影细节上不如黑色墨水；

### YUV

YUV 色彩空间以明亮度（Y）和色度（U和V）来表达色彩。明亮度就是灰阶值，只能反应像素点的光暗而没有彩色，黑白照片就是仅用明亮度组成的图像。色度代表颜色的饱和程度，UV 分别代表蓝色色度信息和红色色度信息。

YUV 最早被设计用于电视信号系统，用于传输彩色电视的信号。早期的黑白电视仅使用灰度值就可以构建电视画面，也就是仅使用明亮度。开始设计彩色电视时，考虑到电视的成像原理，直接传输 RGB 信号是天然的方案。但 RGB 方案有两个缺点，一是 RGB 信号无法简单的与黑白电视兼容，二是相比于黑白电视信号，带宽要扩大为原来的三倍。YUV 的出现完美解决了这两个问题。

1.首先来看与黑白电视的兼容问题：YUV 的 Y 分量代表明亮度（也就是灰阶值），刚好就是黑白电视所需的信号，那么黑白电视接入彩色信号后，只要简单的忽略 UV 分量，即可实现兼容。

2.再来看 YUV 是如何节省带宽的：正常来说，YUV 三个分量每个分量使用 8 位存储，与 RGB 占用的空间是相同的，但是研究发现人眼对亮度比对颜色更敏感，也就是说从人眼感知的角度看，Y 分量比 UV 分量重要的多。所以可以通过对 UV 分量降采样来节省带宽。

> 可以观察下面的图像来佐证人眼对亮度更敏感，左图中的方块 A 和方块 B 的颜色是相同的，我们的大脑更多的去注意光与暗（亮度），所以会产生颜色不同的错觉。右图中使用一个颜色相同的区域将方块 A 和 B 连接起来，我们就能分辨它们是同样的颜色。
> 
> ![luminance_vs_color](https://github.com/zhangqicode/article/assets/2979857/19b82859-0b5d-4bd4-b0fa-95ee237bf230)
> 
> 下图直观地说明了 YUV 的各分量包含的内容，Y 表示亮度，U 表示蓝色色度，V 表示红色色度
>
> ![ycbcr](https://github.com/zhangqicode/article/assets/2979857/48764dba-27cf-4f8b-b33c-2ef2c0799317)
>
> 为什么没有绿色色度？
> * 人类的视觉系统对绿色光波段的亮度变化非常敏感，因此 Y 分量实际上包含了大量的绿色信息。只保留与蓝色和红色的色度分量，这样可以在不牺牲视觉质量的情况下减少数据的大小。

色度子采样：对 YUV 中的色度分量（UV）进行降采样又被称为色度子采样。子采样的方法包括 4:4:4、4:2:2、4:2:0、4:1:1，我们常说的 YUV420 其实是在说采样方法，下面就以 4:2:0 来介绍采样的具体方法。

4:2:0 是指每行像素，只有一种色度分量以 2:1（4:2）的抽样率存储，具体来说就是 Y 分量不做采样，UV 分量在水平方向每两个像素采样一个值，在垂直方向交替采样，例如第一行只做 U 分量的采样，第二行只做 V 分量的采样，然后使用时互相使用缺失的分量值（第二行使用第一行的 U）。这种采样模式下，每 4 个像素点会产生 4 个 Y 分量值、1 个 U 分量值和 1 个 V 分量值。那么原本在 RGB 空间中的 4 * 3 = 12 字节就被节省为 6 字节，节省了 50%。

>以像素变化简要说明 YUV420 的采样方法
>
>采样前：
>
>【Y0 U0 V0】【Y1 U1 V1】
>
>【Y2 U2 V2】【Y3 U3 V3】
>
> 采样后（示例）：
>
>【Y0 U0 Y1】
>
>【Y2 V2 Y3】
>
>解码后：
>
>【Y0 U0 V2】【Y1 U0 V2】
>
>【Y2 U0 V2】【Y3 U0 V2】

YUV420 规定了各分量的采样方式，但各分量在采样后的数据中如何排布还可以有多种方式，通常有两种排列方式：Planar 和 Semi-Planar。Planar 是 YUV 分别存储在三个不同的平面中，也就是 4n * Y + n * U + n * V。Semi-Planar 则是 Y 分量单独一个平面，UV 分量交错存储在另一个平面，即 4n * Y + n * UV（或者 VU）。

我们常见的 NV12 是一种具体的图像编码方式，它符合 YUV420 的采样方法，存储上使用 Semi-Planar 方式，具体排布为 4n * Y + n * UV。同样常见的 NV21 与 NV12 的唯一区别是 V 分量在前 U 分量在后，即 4n * Y + n * VU。

> NV12 由于色度分量交错存储，通常更适合于现代视频硬件加速解码和处理，因为硬件可以更高效地访问和处理交错的色度数据。

### 参考文献

[维基百科-色彩空间](https://zh.wikipedia.org/wiki/%E8%89%B2%E5%BD%A9%E7%A9%BA%E9%96%93)

[三原色光模式](https://zh.wikipedia.org/wiki/%E4%B8%89%E5%8E%9F%E8%89%B2%E5%85%89%E6%A8%A1%E5%BC%8F)

[印刷四分色模式-CMYK](https://zh.wikipedia.org/wiki/%E5%8D%B0%E5%88%B7%E5%9B%9B%E5%88%86%E8%89%B2%E6%A8%A1%E5%BC%8F)

[维基百科-YUV](https://zh.wikipedia.org/wiki/YUV)

[digital_video_introduction](https://github.com/leandromoreira/digital_video_introduction/blob/master/README-cn.md)

